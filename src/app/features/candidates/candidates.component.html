<div class="page-wrap">
  <div class="page-shell">

    <div class="head-row">
      <h2 class="title">Candidates</h2>
      <div class="actions">
        <input class="search" type="text" placeholder="Search..." (input)="onSearch($event.target.value)" />
        <button class="btn mint" type="button" (click)="openAdd()">Add</button>
      </div>
    </div>

    <div class="table glassy">
      <div class="row thead">
        <div class="th">ID</div>
        <div class="th">Name</div>
        <div class="th">Email</div>
        <div class="th">Status</div>
        <div class="th" style="text-align:right;">Actions</div>
      </div>

      <ng-container *ngIf="filtered && filtered.length; else emptyState">
        <div class="row" *ngFor="let c of filtered; trackBy: trackById">
          <div class="td">{{ c.id }}</div>
          <div class="td">{{ c.name }}</div>
          <div class="td">{{ c.email }}</div>
          <div class="td">
            <span class="badge"
              [ngClass]="{
                applied: (c.status || '').toLowerCase()==='applied',
                interview: (c.status || '').toLowerCase()==='interview',
                hired: (c.status || '').toLowerCase()==='hired',
                rejected: (c.status || '').toLowerCase()==='rejected'
              }">{{ c.status }}</span>
          </div>
          <div class="td" style="text-align:right;">
            <button class="link" type="button" (click)="openEdit(c)">Edit</button>
            <button class="link danger" type="button" (click)="confirmDelete(c)">Delete</button>
          </div>
        </div>
      </ng-container>

      <ng-template #emptyState>
        <div class="row">
          <div class="td" style="grid-column:1 / -1; opacity:.7; padding:16px;">
            No candidates found.
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" *ngIf="modalOpen" (click)="closeModal()">
  <div class="modal glassy" (click)="$event.stopPropagation()">
    <div class="modal-head">
      <h3 class="modal-title">{{ modalMode === 'add' ? 'Add Candidate' : 'Edit Candidate' }}</h3>
    </div>

    <form #formRef="ngForm" (ngSubmit)="saveForm(formRef)" class="modal-body">
      <div class="form-row">
        <label>Name</label>
        <input class="field" type="text" name="name" [(ngModel)]="formCandidate.name" required />
      </div>

      <div class="form-row">
        <label>Email</label>
        <input class="field" type="email" name="email" [(ngModel)]="formCandidate.email"
               [pattern]="emailRegex" />
        <small class="hint" *ngIf="formRef.submitted && formCandidate.email && !(formCandidate.email.trim().match(emailRegex))">
          Please enter a valid email (example@domain.com).
        </small>
      </div>

      <div class="form-row">
        <label>Status</label>
        <select class="field" name="status" [(ngModel)]="formCandidate.status" required>
          <option>Applied</option>
          <option>Interview</option>
          <option>Hired</option>
          <option>Rejected</option>
        </select>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn mint" [disabled]="modalSaving || !formCandidate.name || formCandidate.name.trim()===''">
          {{ modalMode === 'add' ? 'Create' : 'Save' }}
        </button>
      </div>
    </form>
  </div>
</div>
