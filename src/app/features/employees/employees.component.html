<div class="page-wrap">
  <div class="page-shell">
    <div class="head-row">
      <h2 class="title">Employees</h2>

      <div class="actions">
        <input
          class="search"
          type="text"
          placeholder="Search employees"
          (input)="onSearch($event.target.value)"
        />
        <button class="btn mint" type="button" (click)="openAdd()">+ Add</button>
      </div>
    </div>

    <div class="table glassy">
      <div class="thead row">
        <div class="th">ID</div>
        <div class="th">Name</div>
        <div class="th">Email</div>
        <div class="th">Department</div>
        <div class="th">Hire Date</div>
        <div class="th">Role</div>
        <div class="th right">Actions</div>
      </div>

      <ng-container *ngIf="rows$ | async as view; else emptyState">
        <div
          class="row tr"
          *ngFor="let r of view; trackBy: trackById"
        >
          <div class="td">{{ r.id }}</div>
          <div class="td">{{ r.name || '—' }}</div>
          <div class="td">{{ r.email || '—' }}</div>
          <div class="td">{{ r.departmentName || '—' }}</div>
          <div class="td">{{ r.hireDate || '—' }}</div>
          <div class="td">{{ r.role || '—' }}</div>
          <div class="td right">
            <button class="icon-pill primary" type="button" (click)="openEdit(r)">✏️</button>
            <button class="icon-pill danger" type="button" (click)="delete(r)">🗑️</button>
          </div>
        </div>
      </ng-container>

      <ng-template #emptyState>
        <div class="row">
          <div class="td" style="grid-column:1 / -1; opacity:.7; padding:16px;">
            No employees found.
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" *ngIf="modalOpen" (click)="closeModal()">
  <div class="modal glassy" (click)="$event.stopPropagation()">
    <div class="modal-head">
      <h3 class="modal-title">
        {{ modalMode === 'add' ? 'Add Employee' : 'Edit Employee' }}
      </h3>
    </div>

    <form (ngSubmit)="saveForm()" class="modal-body">
      <div class="form-row">
        <label>Name</label>
        <input class="field" type="text" name="name" [(ngModel)]="formEmp.name" required />
      </div>

      <div class="form-row">
        <label>Email</label>
        <input
          class="field"
          type="email"
          name="email"
          [(ngModel)]="formEmp.email"
          [pattern]="emailRegex"
        />
      </div>

      <div class="form-row">
        <label>Department</label>
        <select class="field" name="departmentId" [(ngModel)]="formEmp.departmentId">
          <option *ngFor="let d of departments" [ngValue]="d.id">{{ d.name }}</option>
        </select>
      </div>

      <div class="form-row">
        <label>Hire Date</label>
        <input class="field" type="date" name="hireDate" [(ngModel)]="formEmp.hireDate" />
      </div>

      <div class="form-row">
        <label>Role</label>
        <input class="field" type="text" name="role" [(ngModel)]="formEmp.role" />
      </div>

      <div class="modal-actions">
        <button type="button" class="btn" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn mint" [disabled]="modalSaving">
          {{ modalMode === 'add' ? 'Create' : 'Save' }}
        </button>
      </div>
    </form>
  </div>
</div>
